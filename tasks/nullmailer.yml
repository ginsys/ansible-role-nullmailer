---
# tasks file for nullmailer
#
- name:     prepare config dir
  action:
    module: file
    dest:   /etc/nullmailer
    state:  directory
    mode:   0755
    owner:  root
    group:  root
  become:   yes

- name:     configure generic mail settings
  action:
    module: template
    src:    '{{ item + ".j2" }}'
    dest:   /etc/mailname
    mode:   0644
    owner:  root
    group:  root
  with_items:
    - mailname
  notify:   restart_nullmailer
  become:   yes

- name:     configure nullmailer
  action:
    module: template
    src:    '{{ item.name + ".j2" }}'
    dest:   /etc/nullmailer/{{ item.name }}
    mode:   '{{ item.mode |default(0644) }}'
    owner:  '{{ item.owner |default("root") }}'
    group:  '{{ item.group |default("root") }}'
  with_items:
    - file: adminaddr
    - file: defaultdomain
    - file: defaulthost
    - file: helohost
    - file: idhost
    - file: me
    - file: pausetime
    - file: remotes
      group: mail
      mode: 0640
    - file: sendtimeout
  notify:   restart_nullmailer
  become:   yes

- name: install
  action:
    module: apt
    pkg:    nullmailer
    state:  latest
  become:   yes
